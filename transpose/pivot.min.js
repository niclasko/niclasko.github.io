var MAX_INT=9007199254740992;
function Pivot(){this.pivotID=Math.floor(2E3*Math.random()+1);this._self=this;this.tabularData;this.tabularDataHeader;this.tabularDataHeaderIndexes;this.pivotRows;this.pivotColumns;this.pivotMeasures;this.dummyMeasureAdded;this.pivotMeasureFormattingOptions;this.pivotMeasuresDisplayNamesSortOrder;this.pivotRowsDisplayNames;this.pivotColumnsDisplayNames;this.pivotMeasuresDisplayNames;this.pivotRowsDisplayNamesIndexes;this.pivotColumnsDisplayNamesIndexes;this.pivotMeasuresDisplayNamesIndexes;this.pivotRowTotals;
this.pivotColumnTotals;this.pivotRowDisplayNamesToRowTotalIndexes;this.pivotColumnDisplayNamesToColumnTotalIndexes;this.pivotRowTotalAncestors;this.pivotColumnTotalAncestors;this.rowTotalIndexes;this.columnTotalIndexes;this.ROW_BELOW=1;this.COLUMN_BELOW=2;this.ROW_ABOVE=3;this.COLUMN_ABOVE=4;this.measureHeaderPlacement=this.COLUMN_BELOW;this.pivotMatrix;this.pivotMatrixMetadata;this.pivotHiddenRows;this.pivotHiddenColumns;this.initialRowIdx;this.initialColumnIdx;this.rowHash;this.columnHash;this.pivotHash;
this.rowHashKeys;this.columnHashKeys;this.columnHashGroupCount=this.rowHashGroupCount=1;this.HTML="";this.totalIndicator="\u00f8\u00f8\u00f8\u00f8\u00f8\u00f8\u00f8\u00f8\u00f8\u00f8\u00f8\u00f8\u00f8\u00f8\u00f8";this.REGULAR=1;this.PERCENTAGE_OF_ROW_TOTAL=2;this.PERCENTAGE_OF_COLUMN_TOTAL=3;this.PERCENTAGE_OF_PANE_TOTAL=4;this.HEATMAP_ROW=1;this.HEATMAP_COLUMN=2;this.HEATMAP_PANE=3;this.MEASURE_INDEX_EXPRESSION_INDICATOR=-1;this.expressions;this.expressionVariables;this.measureCaption="Measure";
this.defaultFormattingOptions={decimals:2,factor:1,displayAs:this.REGULAR,isExpression:!1,expression:""};this.timer=new Timer;this.sortedRowIndexes;this.globalSelfReferenceVariableName="___pivot"+this.pivotID;this.isHeaderFrozen=this.isGlobalSelfReferenceSet=!1;this.setHeaderWidthsFunctionName="setHeaderWidths"+this.pivotID;this.pivotContainerID;this.isCSSset=!1;this.headerTopPixelOffset=0;this.setPivotPlaceHolder=function(a){this.pivotContainerID=a};this.setupTabularData=function(a){a=a.slice();
this.tabularDataHeader=a[0];this.tabularData=a.splice(1);this.tabularDataHeaderIndexes=[];for(a=0;a<this.tabularDataHeader.length;a++)this.tabularDataHeaderIndexes[this.tabularDataHeader[a]]=a;this.initPivot()};this.setTabularDataHeaderOnly=function(a,c){this.tabularDataHeader=a.slice(0);this.tabularDataHeaderIndexes=[];for(var d=0;d<this.tabularDataHeader.length;d++)this.tabularDataHeaderIndexes[this.tabularDataHeader[d]]=d;c&&this.initPivot()};this.addTabularDataHeaderField=function(a){this.tabularDataHeader.push(a);
this.tabularDataHeaderIndexes[a]=this.tabularDataHeader.length-1};this.setTabularDataProjection=function(a){var c=a.slice();a=c[0];for(var c=c.splice(1),d=this.tabularData=[],b,e=this.tabularDataHeader.length,k=this.tabularDataHeaderIndexes,g=0;g<c.length;g++){b=Array(e);d.push(b);for(var m=0;m<a.length;m++)b[k[a[m]]]=c[g][m]}};this.setMeasureHeaderPlacement=function(a){this.measureHeaderPlacement=a};this.initPivot=function(){this.pivotRows=[];this.pivotColumns=[];this.pivotMeasures=[];this.dummyMeasureAdded=
!1;this.pivotMeasureFormattingOptions=[];this.pivotRowsDisplayNames=[];this.pivotColumnsDisplayNames=[];this.pivotMeasuresDisplayNames=[];this.pivotMeasuresDisplayNamesSortOrder=[];this.pivotRowsDisplayNamesIndexes=[];this.pivotColumnsDisplayNamesIndexes=[];this.pivotMeasuresDisplayNamesIndexes=[];this.pivotRowTotals=[];this.pivotColumnTotals=[];this.pivotRowDisplayNamesToRowTotalIndexes=[];this.pivotColumnDisplayNamesToColumnTotalIndexes=[];this.rowTotalIndexes=[];this.columnTotalIndexes=[];this.pivotColumnTotalAncestors=
this.pivotRowTotalAncestors=void 0;this.expressions=[];this.expressionVariables=[]};this.addRow=function(a,c){this.pivotRows.push(this.tabularDataHeaderIndexes[a]);this.pivotRowsDisplayNames.push(c);this.pivotRowsDisplayNamesIndexes[c]=this.pivotRows.length-1;this.setTotalIndicators(this.pivotRows,this.pivotRowTotals,this.pivotRowsDisplayNamesIndexes,"row")};this.removeRow=function(a){for(var c=this.pivotRowsDisplayNamesIndexes[a],d=c+1;d<this.pivotRowsDisplayNames.length;d++)this.pivotRowsDisplayNamesIndexes[this.pivotRowsDisplayNames[d]]--;
delete this.pivotRowsDisplayNamesIndexes[a];this.pivotRows.splice(c,1);this.pivotRowsDisplayNames.splice(c,1);this.removeRowSubTotal(a);0==this.pivotRows.length&&this.removeRowTotal();this.setTotalIndicators(this.pivotRows,this.pivotRowTotals,this.pivotRowsDisplayNamesIndexes,"row")};this.rowCount=function(){return this.pivotRows.length};this.sortTotals=function(a){a.sort(function(a,d){if(a.totalIndicatorCount<d.totalIndicatorCount)return-1;if(a.totalIndicatorCount>d.totalIndicatorCount)return 1;
if(a.totalIndicatorCount==d.totalIndicatorCount)return 0})};this.setTotalIndicators=function(a,c,d,b){for(var e,k,g,m=0;m<c.length;m++){k=c[m];e=k.isGrandTotal?0:d[k.displayName];g=0;k.values=a.slice(0);for(e+=1;e<c.length;e++)k.values[e]=this.totalIndicator,g++;1>=g&&("row"==b?this.removeRowSubTotal(k.displayName):"column"==b&&this.removeColumnSubTotal(k.displayName));k.totalIndicatorCount=g}};this.addRowSubTotal=function(a){if(void 0!=this.pivotRowsDisplayNamesIndexes[a]){var c=this.pivotRowsDisplayNamesIndexes[a],
d=0;if(c!=this.pivotRows.length-1){this.pivotRowTotals.push({displayName:a,values:this.pivotRows.slice(0),totalElementCount:this.pivotRows.length-c+1,isGrandTotal:!1});for(i=c+1;i<this.pivotRows.length;i++)this.pivotRowTotals[this.pivotRowTotals.length-1].values[i]=this.totalIndicator,d++;this.pivotRowTotals[this.pivotRowTotals.length-1].totalIndicatorCount=d;this.sortTotals(this.pivotRowTotals)}}};this.removeRowSubTotal=function(a){for(var c=0;c<this.pivotRowTotals.length;c++)if(this.pivotRowTotals[c].displayName==
a){this.pivotRowTotals.splice(c,1);break}this.sortTotals(this.pivotRowTotals)};this.addRowTotal=function(){if(0!=this.pivotRows.length){var a=0;this.pivotRowTotals.push({displayName:this.totalIndicator,values:this.pivotRows.slice(0),totalElementCount:this.pivotRows.length,isGrandTotal:!0});for(i=0;i<this.pivotRows.length;i++)this.pivotRowTotals[this.pivotRowTotals.length-1].values[i]=this.totalIndicator,a++;this.pivotRowTotals[this.pivotRowTotals.length-1].totalIndicatorCount=a;this.sortTotals(this.pivotRowTotals)}};
this.removeRowTotal=function(){this.removeRowSubTotal(this.totalIndicator)};this.addColumn=function(a,c){this.pivotColumns.push(this.tabularDataHeaderIndexes[a]);this.pivotColumnsDisplayNames.push(c);this.pivotColumnsDisplayNamesIndexes[c]=this.pivotColumns.length-1;this.setTotalIndicators(this.pivotColumns,this.pivotColumnTotals,this.pivotColumnsDisplayNamesIndexes,"column")};this.removeColumn=function(a){for(var c=this.pivotColumnsDisplayNamesIndexes[a],d=c+1;d<this.pivotColumnsDisplayNames.length;d++)this.pivotColumnsDisplayNamesIndexes[this.pivotColumnsDisplayNames[d]]--;
delete this.pivotColumnsDisplayNamesIndexes[a];this.pivotColumns.splice(c,1);this.pivotColumnsDisplayNames.splice(c,1);this.removeColumnSubTotal(a);0==this.pivotColumns.length&&this.removeColumnTotal();this.setTotalIndicators(this.pivotColumns,this.pivotColumnTotals,this.pivotColumnsDisplayNamesIndexes,"column")};this.columnCount=function(){return this.pivotColumns.length};this.addColumnSubTotal=function(a){if(void 0!=this.pivotColumnsDisplayNamesIndexes[a]){var c=this.pivotColumnsDisplayNamesIndexes[a],
d=0;if(c!=this.pivotColumns.length-1){this.pivotColumnTotals.push({displayName:a,values:this.pivotColumns.slice(0),isGrandTotal:!1});for(i=c+1;i<this.pivotColumns.length;i++)this.pivotColumnTotals[this.pivotColumnTotals.length-1].values[i]=this.totalIndicator,d++;this.pivotColumnTotals[this.pivotColumnTotals.length-1].totalIndicatorCount=d;this.sortTotals(this.pivotColumnTotals)}}};this.removeColumnSubTotal=function(a){for(var c=0;c<this.pivotColumnTotals.length;c++)if(this.pivotColumnTotals[c].displayName==
a){this.pivotColumnTotals.splice(c,1);break}this.sortTotals(this.pivotColumnTotals)};this.addColumnTotal=function(){if(0!=this.pivotColumns.length){var a=0;this.pivotColumnTotals.push({displayName:this.totalIndicator,values:this.pivotColumns.slice(0),totalElementCount:this.pivotColumns.length,isGrandTotal:!0});for(i=0;i<this.pivotColumns.length;i++)this.pivotColumnTotals[this.pivotColumnTotals.length-1].values[i]=this.totalIndicator,a++;this.pivotColumnTotals[this.pivotColumnTotals.length-1].totalIndicatorCount=
a;this.sortTotals(this.pivotColumnTotals)}};this.removeColumnTotal=function(){this.removeColumnSubTotal(this.totalIndicator)};this.addMeasure=function(a,c,d){void 0==d&&(d=clone(this.defaultFormattingOptions));d.isExpression?(this.pivotMeasures.push(this.MEASURE_INDEX_EXPRESSION_INDICATOR),d.expression=a):this.pivotMeasures.push(this.tabularDataHeaderIndexes[a]);this.pivotMeasuresDisplayNames.push(c);this.pivotMeasuresDisplayNamesIndexes[c]=this.pivotMeasures.length-1;this.pivotMeasureFormattingOptions.push(d)};
this.removeMeasure=function(a){for(var c=this.pivotMeasuresDisplayNamesIndexes[a],d=c+1;d<this.pivotMeasuresDisplayNames.length;d++)this.pivotMeasuresDisplayNamesIndexes[this.pivotMeasuresDisplayNames[d]]--;this.pivotMeasures.splice(c,1);this.pivotMeasuresDisplayNames.splice(c,1);delete this.pivotMeasuresDisplayNamesIndexes[a];this.pivotMeasureFormattingOptions.splice(c,1)};this.setMeasureFormattingOptions=function(a,c,d){this.pivotMeasureFormattingOptions[this.pivotMeasuresDisplayNamesIndexes[a]][c]=
d};this.removeMeasureFormattingOption=function(a,c){delete this.pivotMeasureFormattingOptions[this.pivotMeasuresDisplayNamesIndexes[a]][c]};this.setMeasurePercentageOfRowTotal=function(a){this.setMeasureFormattingOptions(a,"displayAs",this.PERCENTAGE_OF_ROW_TOTAL)};this.setMeasurePercentageOfColumnTotal=function(a){this.setMeasureFormattingOptions(a,"displayAs",this.PERCENTAGE_OF_COLUMN_TOTAL)};this.setMeasurePercentageOfPaneTotal=function(a){this.setMeasureFormattingOptions(a,"displayAs",this.PERCENTAGE_OF_PANE_TOTAL)};
this.measurePercentageClear=function(a){this.setMeasureFormattingOptions(a,"displayAs",this.REGULAR)};this.setMeasureHeatmapRow=function(a){this.setMeasureFormattingOptions(a,"HeatMapType",this.HEATMAP_ROW)};this.setMeasureHeatmapColumn=function(a){this.setMeasureFormattingOptions(a,"HeatMapType",this.HEATMAP_COLUMN)};this.setMeasureHeatmapPane=function(a){this.setMeasureFormattingOptions(a,"HeatMapType",this.HEATMAP_PANE)};this.clearMeasureHeatmap=function(a){this.removeMeasureFormattingOption(a,
"HeatMapType")};this.addDummyMeasureIfNecessary=function(){0==this.pivotMeasures.length&&(this.addMeasure("",""),this.dummyMeasureAdded=!0)};this.removeDummyMeasureIfNecessary=function(){if(this.dummyMeasureAdded&&(1<this.pivotMeasures.length||0==this.pivotRows.length+this.pivotColumns.length&&1==this.pivotMeasures.length)){for(var a=1;a<this.pivotMeasuresDisplayNames.length;a++)this.pivotMeasuresDisplayNamesIndexes[this.pivotMeasuresDisplayNames[a]]--;this.pivotMeasures.splice(0,1);this.pivotMeasuresDisplayNames.splice(0,
1);delete this.pivotMeasuresDisplayNamesIndexes[""];this.pivotMeasureFormattingOptions.splice(0,1);this.dummyMeasureAdded=!1}};this.parseMeasureExpressions=function(){for(var a,c,d=[],b=[],e=0;e<this.pivotMeasureFormattingOptions.length;e++)if(this.pivotMeasureFormattingOptions[e].isExpression){a=this.pivotMeasureFormattingOptions[e].expression;for(var k=0;k<this.pivotMeasuresDisplayNames.length;k++)this.pivotMeasureFormattingOptions[k].isExpression||(c=RegExp(this.pivotMeasuresDisplayNames[k],"g"),
c.test(a)&&(d.push(k-e),a=a.replace(c,"v["+this.expressionVariables.length+"]"),this.expressionVariables.push(this.expressionVariables.length),b.push(this.expressionVariables.length-1)));this.expressions.push([eval("(function(v) { return "+a+"; })"),d,b]);this.pivotMeasureFormattingOptions[e].expressionIndex=this.expressions.length-1}};this.subArrayList=function(a,c,d){for(var b=[],e=0;e<c.length;e++)b.push(this.subArray(a,void 0!=d?c[e][d]:c[e]));return b};this.subArray=function(a,c){for(var d=[],
b,e=0;e<c.length;e++)b=c[e],void 0!=a[b]?d.push(a[b]):d.push(b);return d};this.matrix=function(a,c){for(var d=Array(a),b=0;b<a;b++)d[b]=Array(c);return d};this.isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)};this.isMeasureValueCell=function(a,c){return a>=this.initialRowIdx&&c>=this.initialColumnIdx};this.getHTML=function(){return this.HTML};this.addGlobalSelfReference=function(){if(!this.isGlobalSelfReferenceSet){var a=document.createElement("script"),c;c="var "+this.globalSelfReferenceVariableName+
";";c+="function setGSR"+this.pivotID+"(pivotObject) {";c+="\t"+this.globalSelfReferenceVariableName+" = pivotObject;";a.type="text/javascript";a.innerHTML=c+"}";document.getElementsByTagName("head")[0].appendChild(a);window["setGSR"+this.pivotID].call(this,this._self);this.isGlobalSelfReferenceSet=!0}};this.setCSS=function(){if(!this.isCSSset){var a=document.createElement("style");a.type="text/css";var c;c=".bt { font-weight: bold; } .tr { text-align: right; } .brv { border-top: thin solid; border-bottom: thin solid; border-color: black; }";
c+=" .brt { border-bottom: thin solid; border-color: black; }";c+=' .ts { font-family:"Verdana", Verdana, Sans-serif; font-size:x-small; border-spacing:0; border-collapse:collapse; table-layout:fixed; white-space: nowrap; }';c+=" .alt { background-color: #F0F0F0; }";c+=" .fx { position: fixed; background-color: white; box-shadow: 0 4px 3px -3px gray; top: "+this.headerTopPixelOffset+"px; }";c+=" img { border-style: none; }";a.styleSheet?a.styleSheet.cssText=c:a.appendChild(document.createTextNode(c));
document.getElementsByTagName("head")[0].appendChild(a);this.isCSSset=!0}};this.setHeaderTopPixelOffset=function(a){this.headerTopPixelOffset=a};this.toHTML=function(){this.HTML="";if(0!=this.pivotRows.length+this.pivotColumns.length+this.pivotMeasures.length){var a=this.pivotID,c=0,d;this.setCSS();this.addGlobalSelfReference();var b;b='\x3c!--div style="overflow-y: auto; height: 100%;"--\x3e'+('<table class="ts" id="___pivotHeader'+a+'"></table>')+('<table class="ts" id="___pivot'+a+'">');for(var e,
k,g,m,q,s,h,n,f,v,t,l=0,p,r,C,D,A,B,x,E=this.sortedRowIndexes,u,z=this.globalSelfReferenceVariableName,G=this.pivotHash,F,y=0;y<this.pivotMatrix.length;y++)if(u=void 0!=E?E[y]:y,!this.pivotHiddenRows[u]){0==u&&(b+='<thead id="___pivotRegularHeader'+a+'">');y==this.initialRowIdx&&(b+="<tbody>");b+="<tr>";p?l=0:y>this.initialRowIdx&&l++;for(var w=0;w<this.pivotMatrix[u].length;w++)this.pivotHiddenColumns[w]||(k=e="",d=this.pivotMatrix[u][w],q=this.pivotMatrixMetaData[u][w],p=this.rowTotalIndexes[u+
"_"],r=this.columnTotalIndexes[w+"_"],C=p||r,null==d&&void 0==q?g="&nbsp;":null==d&&void 0!=q?g="&nbsp;":this.isMeasureValueCell(u,w)?(t=void 0!=q.formattingOptions?q.formattingOptions:null,n=q.rowTotalAncestor,f=q.columnTotalAncestor,v=q.paneTotalAncestor,F=q.rowHashKey,D=q.columnHashKey,e+=" tr",q=t.decimals,s=t.factor,h=t.displayAs,this.isNumber(d)?h==this.REGULAR?m=g=(d/s).toFixed(q):h==this.PERCENTAGE_OF_ROW_TOTAL?(x=null!=n?n.cellValue:d,0!=x?(m=(100*(d/x)).toFixed(q),g=m+"%"):g="&nbsp;"):h==
this.PERCENTAGE_OF_COLUMN_TOTAL?(x=null!=f?f.cellValue:d,0!=x?(m=(100*(d/x)).toFixed(q),g=m+"%"):g="&nbsp;"):h==this.PERCENTAGE_OF_PANE_TOTAL&&(null!=v?x=v.cellValue:null==v&&(x=p&&null!=f?f.cellValue:r&&null!=n?n.cellValue:d),0!=x?(m=(100*(d/x)).toFixed(q),g=m+"%"):g="&nbsp;"):(g="&nbsp;",m=null),G[F][D].transformedCellValue=parseFloat(m),t=t.HeatMapType,C||void 0==t||(t==this.HEATMAP_ROW&&null!=n?(A=n.min,B=n.max):t==this.HEATMAP_COLUMN&&null!=f?(A=f.min,B=f.max):t==this.HEATMAP_PANE&&null!=v&&
(A=v.min,B=v.max),k="background-color: "+getHeatMapColor(d,A,B))):(d.replace?(g=d.replace(this.totalIndicator,"Total"),g=g.replace(/\{\d+\}/g,"")):g="&nbsp;",u==this.initialRowIdx-1&&w>=this.initialColumnIdx&&!this.dummyMeasureAdded&&(d=a+"_"+c++,g='<a href="javascript:void(0)"><img id="'+d+'" src="sort.png" onclick="GUIsort'+this.pivotID+"(this, '"+this.columnHashKeys[w-this.initialColumnIdx]+"');\"><a/>&nbsp;"+g)),e+=u<this.initialRowIdx&&w>=this.initialColumnIdx?" tr":"",e+=C?" bt":"",e+=p?" brv":
"",e+=u==this.initialRowIdx-1?" brt":"",u>=this.initialRowIdx&&!p&&0!=l%2&&(e+=" alt"),e=""!=e?'<td class="'+e+'"':"<td",""!=k&&(e+=' style="'+k+'"'),e=u<=this.initialRowIdx?e+(' id="c'+u+"_"+w+'">'):e+">",b+=e+g+"</td>");b+="</tr>";y==this.initialRowIdx&&(b+="</thead>")}b+="</tbody></table>\x3c!--/div--\x3e";this.isHeaderFrozen||(b+='<script type="text/javascript">',b+="\tvar frozenHeader"+this.pivotID+" = undefined;",b+="\tvar sortedColumnImgElementID"+this.pivotID+";",b+="\tvar pivotTableWidth"+
this.pivotID+";",b+="\tfunction "+this.setHeaderWidthsFunctionName+"() {",b+="\t\tvar e, d = document;",b+="\t\tvar widths = new Array("+this.pivotMatrix[0].length+");",b+="\t\tvar rowIdx = "+this.initialRowIdx+";",b+="\t\tfor(var i=0; i<"+this.pivotMatrix[0].length+"; i++) {",b+="\t\t\te = d.getElementById('c' + rowIdx + '_' + i + '');",b+="\t\t\twidths[i] = (e != null ? e.offsetWidth : -1);",b+="\t\t}",b+="\t\tfor(var i=0; i<"+this.initialRowIdx+"; i++) {",b+="\t\t\tfor(var j=0; j<"+this.pivotMatrix[0].length+
";j++) {",b+="\t\t\t\te = d.getElementById('c' + i + '_' + j + '');",b+="\t\t\t\tif(e != null) e.style.width = widths[j] + 'px';",b+="\t\t\t}",b+="\t\t}",b+="\t\tif(frozenHeader"+this.pivotID+" != undefined) {",b+="\t\t\tfrozenHeader"+this.pivotID+".innerHTML = frozenHeaderHTML"+this.pivotID+";",b+="\t\t\td.getElementById('___pivotHeader"+this.pivotID+"').appendChild(frozenHeader"+this.pivotID+");",b+="\t\t} else {",b+="\t\t\tvar header = document.getElementById('___pivotRegularHeader"+this.pivotID+
"').cloneNode(true);",b+="\t\t\theader.setAttribute('id', '___pivotFrozenHeader"+this.pivotID+"');",b+="\t\t\theader.setAttribute('class', 'fx');",b+="\t\t\theader.setAttribute('className', 'fx');",b+="\t\t\td.getElementById('___pivotHeader"+this.pivotID+"').appendChild(header);",b+="\t\t\tfrozenHeader"+this.pivotID+" = header;",b+="\t\t\tfrozenHeaderHTML"+this.pivotID+" = header.innerHTML;",b+="\t\t}",b+="\t}",b+="\t"+this.setHeaderWidthsFunctionName+"();",b+="\tfunction GUIsort"+this.pivotID+"(img, column) {",
b+="\t\tvar sortImg;",b+="\t\tif(img.src.indexOf('sort.png') > -1) {",b+="\t\t\timg.src = 'sort_desc.png';",b+="\t\t\t"+z+".sortByColumn(column, 1);",b+="\t\t} else if(img.src.indexOf('sort_desc.png') > -1) {",b+="\t\t\timg.src = 'sort_asc.png';",b+="\t\t\t"+z+".sortByColumn(column, -1);",b+="\t\t} else {",b+="\t\t\timg.src = 'sort.png';",b+="\t\t\t"+z+".clearSort();",b+="\t\t}",b+="\t\tfrozenHeaderHTML"+this.pivotID+" = frozenHeader"+this.pivotID+".innerHTML;",b+="\t\t"+z+".toHTML();",b+="\t\tdocument.getElementById('"+
this.pivotContainerID+"').innerHTML = "+z+".getHTML();",b+="\t\t"+this.setHeaderWidthsFunctionName+"();",b+="\t\tsortImg = document.getElementById(sortedColumnImgElementID"+this.pivotID+");",b+="\t\tif(sortImg != null && sortImg.id != img.id) {",b+="\t\t\tsortImg.src = 'sort.png';",b+="\t\t}",b+="\t\tsortedColumnImgElementID"+this.pivotID+" = img.id;",b+="\t}",b+="\x3c/script>",this.isHeaderFrozen=!0);this.HTML=b}};this.getKeys=function(a){var c=[],d;for(d in a)c.push(d);return c};this.sortTree=function(a,
c,d,b){a.sort(function(a,c){if(a.value<c.value)return d;if(a.value>c.value)return b;if(a.value==c.value)return 0});for(var e=0;e<a.length;e++)c.unshift(a[e].index),this.sortTree(a[e].branch,c,d,b)};this.buildRowSortTree=function(a){for(var c=this.getKeys(this.rowHash),d=Array(this.pivotRowTotals.length+2),b,e,k=this.pivotRowTotalAncestors,g,m,q,s=0;s<d.length;s++)d[s]=[];d[0].root=[];for(s=0;s<c.length;s++)b=c[s],e=k[b],m=null,void 0!=this.pivotHash[b][a]&&(m=this.pivotHash[b][a].transformedCellValue),
q=this.rowHash[b].index,void 0==e?(g=1,e="root"):(g=e.layer+1,e=e.ancestorList[0]),void 0==d[g][b]&&(d[g][b]=[]),void 0==d[g-1][e]&&(d[g-1][e]=[]),e==b&&(e="root"),d[g-1][e].push({key:b,value:m,index:q,branch:d[g][b]});return d[0].root};this.clearSort=function(){this.sortedRowIndexes=void 0};this.sortByColumn=function(a,c){if(void 0!=this.columnHash[a]){var d=void 0!=c?c:1,b;1==d?(d=-1,b=1):-1==d?(d=1,b=-1):(d=-1,b=1);this.sortedRowIndexes=[];this.sortTree(this.buildRowSortTree(a),this.sortedRowIndexes,
d,b);for(d=0;d<this.initialRowIdx;d++)this.sortedRowIndexes.unshift(d)}};this.transpose=function(){this.parseMeasureExpressions();this.isHeaderFrozen=!1;this.clearSort();var a,c,d,b,e,k,g,m,q,s,h=this.pivotColumns.length+(this.measureHeaderPlacement==this.COLUMN_BELOW||this.measureHeaderPlacement==this.COLUMN_ABOVE?1:0),n=this.pivotRows.length+(this.measureHeaderPlacement==this.ROW_BELOW||this.measureHeaderPlacement==this.ROW_ABOVE?1:0);this.initialRowIdx=h;this.initialColumnIdx=n;this.rowHash=[];
this.columnHash=[];var f;this.pivotHash=[];var v=[];this.pivotRowTotalAncestors=[];this.pivotColumnTotalAncestors=[];this.rowTotalIndexes=[];this.columnTotalIndexes=[];var t;this.addDummyMeasureIfNecessary();this.removeDummyMeasureIfNecessary();for(var l=0;l<this.tabularData.length;l++){t=this.tabularData[l];for(var p=0;p<this.pivotMeasures.length;p++){q=[];s=[];e=this.subArray(t,this.pivotRows);k=this.subArray(t,this.pivotColumns);0<this.pivotRowTotals.length&&(g=this.subArrayList(t,this.pivotRowTotals,
"values"));0<this.pivotColumnTotals.length&&(m=this.subArrayList(t,this.pivotColumnTotals,"values"));if(this.measureHeaderPlacement==this.COLUMN_BELOW){if(k.push("{"+p+"}"+this.pivotMeasuresDisplayNames[p]),void 0!=m)for(f=0;f<m.length;f++)m[f].push("{"+p+"}"+this.pivotMeasuresDisplayNames[p])}else if(this.measureHeaderPlacement==this.COLUMN_ABOVE){if(k.unshift("{"+p+"}"+this.pivotMeasuresDisplayNames[p]),void 0!=m)for(f=0;f<m.length;f++)m[f].unshift("{"+p+"}"+this.pivotMeasuresDisplayNames[p])}else if(this.measureHeaderPlacement==
this.ROW_BELOW){if(e.push("{"+p+"}"+this.pivotMeasuresDisplayNames[p]),void 0!=g)for(f=0;f<g.length;f++)g[f].push("{"+p+"}"+this.pivotMeasuresDisplayNames[p])}else if(this.measureHeaderPlacement==this.ROW_ABOVE&&(e.unshift("{"+p+"}"+this.pivotMeasuresDisplayNames[p]),void 0!=g))for(f=0;f<g.length;f++)g[f].unshift("{"+p+"}"+this.pivotMeasuresDisplayNames[p]);q.push({isTotal:!1,values:e});s.push({isTotal:!1,values:k});if(void 0!=g)for(f=0;f<g.length;f++){q.push({isTotal:!0,values:g[f]});a=e.join();
void 0==this.pivotRowTotalAncestors[a]&&(this.pivotRowTotalAncestors[a]={ancestorList:[],ancestorKeyLookup:[],layer:g.length-1-f+1});d=g[f].join();void 0==this.pivotRowTotalAncestors[a].ancestorKeyLookup[d]&&(this.pivotRowTotalAncestors[a].ancestorKeyLookup[d]=this.pivotRowTotalAncestors[a].ancestorList.push(d)-1);for(var r=f;r<g.length;r++)b=g[r].join(),r<g.length-1&&d==b&&1<g.length||(void 0==this.pivotRowTotalAncestors[d]&&(this.pivotRowTotalAncestors[d]={ancestorList:[],ancestorKeyLookup:[],layer:g.length-
1-f}),void 0==this.pivotRowTotalAncestors[d].ancestorKeyLookup[b]&&(this.pivotRowTotalAncestors[d].ancestorKeyLookup[b]=this.pivotRowTotalAncestors[d].ancestorList.push(b)-1))}if(void 0!=m)for(f=0;f<m.length;f++)for(s.push({isTotal:!0,values:m[f]}),c=k.join(),void 0==this.pivotColumnTotalAncestors[c]&&(this.pivotColumnTotalAncestors[c]={ancestorList:[],ancestorKeyLookup:[],layer:m.length-1-f+1}),b=m[f].join(),void 0==this.pivotColumnTotalAncestors[c].ancestorKeyLookup[b]&&(this.pivotColumnTotalAncestors[c].ancestorKeyLookup[b]=
this.pivotColumnTotalAncestors[c].ancestorList.push(b)-1),r=f;r<m.length;r++)d=m[r].join(),r<m.length-1&&b==d&&1<m.length||(void 0==this.pivotColumnTotalAncestors[b]&&(this.pivotColumnTotalAncestors[b]={ancestorList:[],ancestorKeyLookup:[],layer:m.length-1-f}),void 0==this.pivotColumnTotalAncestors[b].ancestorKeyLookup[d]&&(this.pivotColumnTotalAncestors[b].ancestorKeyLookup[d]=this.pivotColumnTotalAncestors[b].ancestorList.push(d)-1));for(f=0;f<q.length;f++)for(r=0;r<s.length;r++)if(a=q[f].values.join(),
c=s[r].values.join(),d=q[f].isTotal,b=s[r].isTotal,a in this.rowHash||(this.rowHash[a]={index:h++,values:q[f].values,isTotal:d}),c in this.columnHash||(this.columnHash[c]={index:n++,values:s[r].values,isTotal:b}),a in this.pivotHash||(this.pivotHash[a]=[]),e=this.pivotMeasures[p],!(c in this.pivotHash[a]))k=e!=this.MEASURE_INDEX_EXPRESSION_INDICATOR?parseFloat(this.tabularData[l][e]):null,k=isNaN(k)?null:k,this.pivotHash[a][c]=e==this.MEASURE_INDEX_EXPRESSION_INDICATOR||d||b?{cellValue:k,count:0,
min:MAX_INT,max:-1*MAX_INT,formattingOptions:this.pivotMeasureFormattingOptions[p],isRowTotal:d,isColumnTotal:b}:{cellValue:k,count:1,min:k,max:k,formattingOptions:this.pivotMeasureFormattingOptions[p],isRowTotal:d,isColumnTotal:b};else if(e!=this.MEASURE_INDEX_EXPRESSION_INDICATOR)if(k=parseFloat(this.tabularData[l][e]),k=isNaN(k)?null:k,d=this.pivotHash[a][c],null==d.cellValue&&null==k)d.cellValue=k;else if(null!=d.cellValue||null!=k)d.cellValue+=k}}f=this.getKeys(this.rowHash).sort();g=this.getKeys(this.columnHash).sort();
this.rowHashKeys=f;this.columnHashKeys=g;for(l=0;l<f.length;l++)this.rowHash[f[l]].index=l+this.initialRowIdx,this.rowHash[f[l]].isTotal&&(this.rowTotalIndexes[this.rowHash[f[l]].index+"_"]=!0);for(l=0;l<g.length;l++)this.columnHash[g[l]].index=l+this.initialColumnIdx,this.columnHash[g[l]].isTotal&&(this.columnTotalIndexes[this.columnHash[g[l]].index+"_"]=!0);this.pivotMatrix=this.matrix(h,n);this.pivotMatrixMetaData=this.matrix(h,n);for(l=0;l<h;l++)for(p=0;p<n;p++)this.pivotMatrix[l][p]=null;f=0;
this.measureHeaderPlacement==this.ROW_ABOVE?void 0!=this.pivotMatrix[this.initialRowIdx-1]&&(this.pivotMatrix[this.initialRowIdx-1][0]=this.measureCaption,f=1):this.measureHeaderPlacement==this.ROW_BELOW&&void 0!=this.pivotMatrix[this.initialRowIdx-1]&&(this.pivotMatrix[this.initialRowIdx-1][this.initialColumnIdx-1]=this.measureCaption);if(void 0!=this.pivotMatrix[this.initialRowIdx-1])for(l=0;l<this.pivotRowsDisplayNames.length;l++)this.pivotMatrix[this.initialRowIdx-1][l+f]=this.pivotRowsDisplayNames[l];
this.pivotHiddenRows=Array(h);this.pivotHiddenColumns=Array(n);for(a in this.rowHash){h=this.rowHash[a];this.measureHeaderPlacement==this.ROW_BELOW&&(h.values[h.values.length-1]=h.values[h.values.length-1].replace(/\{\d+\}/g,""));this.measureHeaderPlacement==this.ROW_ABOVE&&(h.values[0]=h.values[0].replace(/\{\d+\}/g,""));for(l=0;l<h.values.length;l++)this.pivotMatrix[h.index][l]=h.values[l];for(c in this.columnHash){n=this.columnHash[c];this.measureHeaderPlacement==this.COLUMN_BELOW&&(n.values[n.values.length-
1]=n.values[n.values.length-1].replace(/\{\d+\}/g,""));this.measureHeaderPlacement==this.COLUMN_ABOVE&&(n.values[0]=n.values[0].replace(/\{\d+\}/g,""));for(l=0;l<n.values.length;l++)this.pivotMatrix[l][n.index]=n.values[l];d=this.pivotHash[a][c];if(void 0!=d){if(this.isNumber(d.cellValue)||d.formattingOptions.isExpression){this.pivotMatrix[h.index][n.index]=d.cellValue;this.pivotMatrixMetaData[h.index][n.index]={formattingOptions:d.formattingOptions,rowHashKey:a,columnHashKey:c,isTotal:h.isTotal||
n.isTotal,isRowTotal:h.isTotal,isColumnTotal:n.isTotal,rowTotalAncestor:null,columnTotalAncestor:null,paneTotalAncestor:null,isBlank:!1};if(d.formattingOptions.hidden){if(this.measureHeaderPlacement==this.ROW_BELOW||this.measureHeaderPlacement==this.ROW_ABOVE)this.pivotHiddenRows[h.index]=!0;if(this.measureHeaderPlacement==this.COLUMN_BELOW||this.measureHeaderPlacement==this.COLUMN_ABOVE)this.pivotHiddenColumns[n.index]=!0}d.formattingOptions.isExpression&&v.push([!0,d.formattingOptions.expressionIndex,
h.index,n.index,a,c,this.pivotRowTotalAncestors[a],this.pivotColumnTotalAncestors[c],!1]);void 0==this.pivotRowTotalAncestors[a]&&void 0==this.pivotColumnTotalAncestors[c]||v.push([!1,-1,h.index,n.index,a,c,this.pivotRowTotalAncestors[a],this.pivotColumnTotalAncestors[c],!1])}}else this.pivotMatrix[h.index][n.index]=null,this.pivotMatrixMetaData[h.index][n.index]={formattingOptions:null,rowHashKey:a,columnHashKey:c,isTotal:h.isTotal||n.isTotal,isRowTotal:h.isTotal,isColumnTotal:n.isTotal,rowTotalAncestor:null,
columnTotalAncestor:null,paneTotalAncestor:null,isBlank:!0},v.push([!1,-1,h.index,n.index,a,c,this.pivotRowTotalAncestors[a],this.pivotColumnTotalAncestors[c],!0])}}this.measureHeaderPlacement==this.ROW_ABOVE&&(this.rowHashGroupCount=this.getKeys(this.rowHash).length/this.pivotMeasures.length);this.measureHeaderPlacement==this.COLUMN_ABOVE&&(this.columnHashGroupCount=this.getKeys(this.columnHash).length/this.pivotMeasures.length);for(l=0;l<v.length;l++){a=v[l];if(a[0]){expression=this.expressions[a[1]];
for(f=0;f<expression[2].length;f++){if(this.measureHeaderPlacement==this.ROW_ABOVE||this.measureHeaderPlacement==this.ROW_BELOW)this.expressionVariables[expression[2][f]]=this.pivotMatrix[a[2]+expression[1][f]*this.rowHashGroupCount][a[3]];if(this.measureHeaderPlacement==this.COLUMN_ABOVE||this.measureHeaderPlacement==this.COLUMN_BELOW)this.expressionVariables[expression[2][f]]=this.pivotMatrix[a[2]][a[3]+expression[1][f]*this.columnHashGroupCount]}c=expression[0](this.expressionVariables);this.pivotMatrix[a[2]][a[3]]=
c;this.pivotHash[a[4]][a[5]].cellValue=c}k=this.pivotMatrix[a[2]][a[3]];c=this.pivotMatrixMetaData[a[2]][a[3]];void 0!=a[6]&&0<a[6].ancestorList.length&&(d=a[6].ancestorList[0],d!=a[4]&&(h=this.pivotHash[d][a[5]],a[8]||h.isRowTotal&&h.isColumnTotal||(h.count++,k>h.max&&(h.max=k),k<h.min&&(h.min=k)),null==c.rowTotalAncestor&&(c.rowTotalAncestor=h)));void 0!=a[7]&&0<a[7].ancestorList.length&&(b=a[7].ancestorList[0],b!=a[5]&&(h=this.pivotHash[a[4]][a[7].ancestorList[0]],a[8]||h.isRowTotal&&h.isColumnTotal||
(h.count++,k>h.max&&(h.max=k),k<h.min&&(h.min=k)),null==c.columnTotalAncestor&&(c.columnTotalAncestor=h)));void 0!=a[6]&&void 0!=a[7]&&0<a[6].ancestorList.length&&0<a[7].ancestorList.length&&(d=a[6].ancestorList[0],b=a[7].ancestorList[0],d!=a[4]&&b!=a[5]&&(h=this.pivotHash[a[6].ancestorList[0]][a[7].ancestorList[0]],a[8]||(h.count++,k>h.max&&(h.max=k),k<h.min&&(h.min=k)),null==c.paneTotalAncestor&&(c.paneTotalAncestor=h)))}}}var scale="#f1f2f0 #eff1ed #edf0ea #ecefe8 #eaefe5 #e8eee3 #e7ede0 #e5edde #e4ecdb #e2ebd9 #e0ead6 #dfead4 #dde9d1 #dbe8cf #dae8cc #d8e7ca #d6e6c8 #d5e5c5 #d3e5c3 #d1e4c0 #d0e3be #cee3bc #cce2b9 #cbe1b7 #c9e0b5 #c7e0b2 #c6dfb0 #c4deae #c2deab #c1dda9 #bfdca7 #bddba5 #bcdba2 #badaa0 #b8d99e #b7d99c #b5d89a #b3d797 #b2d695 #b0d693 #aed591 #add48f #abd48d #a9d38a #a8d288 #a6d186 #a5d184 #a3d082 #a1cf80 #a0cf7e".split(" ");
function getHeatMapColor(a,c,d){if(0==a)return"#FFFFFF";a=Math.round(Math.abs((a-c)/(d-c))*(scale.length-1));return scale[a]}function clone(a){if(null==a||"object"!=typeof a)return a;var c=a.constructor(),d;for(d in a)a.hasOwnProperty(d)&&(c[d]=a[d]);return c};
